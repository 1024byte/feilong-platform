<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="content-type" content="text/html; charset=GBK"/>
<title>Google AJAX Search API Sample</title>
<style type="text/css"> 
@import url("http://www.google.com/uds/css/gsearch.css");
@import url("http://www.google.com/uds/solutions/localsearch/gmlocalsearch.css");
@import url("http://www.google.com/uds/css/gsearch.css");
@import url("http://www.google.com/uds/solutions/localsearch/gmlocalsearch.css");

</style>
<script type="text/javascript" src="res/feilong/js/plugins/jquery/jquery-1.7.1.min.js"></script>
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script type="text/javascript">


	var map;
	var lat = 31.238;
	var lng = 121.48;

	var markersArray = [];
	var windowArray = [];
 
	$(function() {

		var mapDiv = document.getElementById("map-canvas");
		map = new google.maps.Map(mapDiv, {
			center : new google.maps.LatLng(lat, lng),
			zoom : 13,
			mapTypeId : google.maps.MapTypeId.ROADMAP
		});

		$("#search").click(function() {
	    	 search(lat, lng);
		});
		
	    google.maps.event.addListener(map, 'dblclick', function(event) {	    	
	      	//alert("你选择的纬度是："+event.latLng.lat()+"   经度是："+event.latLng.lng());	        
	    	 lat = event.latLng.lat();
	    	 lng = event.latLng.lng();	    	 
	    	 search(lat, lng);
	    }); 
	});
	
	function search(lat, lng){
   	 	var keyWord = document.getElementById("keyWord").value;
   	 	
   	 	//if(){}
		mapIframe.window.searchMap(lat, lng, keyWord);
	}


	function showResult(results) {
		parent.deleteOverlays();
		windowArray.length = 0;
		for ( var i = 0; results && i < results.length; i++) {
			showOne(results[i]);
		}
	}
	function showOne(result) {
		//console.debug(result.title+","+result.lat+":" + result.lng +","+result.streetAddress+","+result.city+","+result.url);
		var infowindow = new google.maps.InfoWindow({
			content : result.html
		});
		var marker = new google.maps.Marker({
			position : new google.maps.LatLng(result.lat, result.lng),
			map : map
		});
		markersArray.push(marker);
		windowArray.push(infowindow);
		google.maps.event.addListener(marker, 'click', function() {
			closeWindows();
			infowindow.open(map, marker);
		});
	}
	
	
	//关闭信息提示窗口
	function closeWindows() {
		if (windowArray) {
			for (i in windowArray) {
				windowArray[i].close();
			}
		}
	}
	

	//删除叠加层
	function deleteOverlays() {
		if (markersArray) {
			for (i in markersArray) {
				markersArray[i].setMap(null);
			}
			markersArray.length = 0;
		}
	}
</script>
</head>

<body >
<input type="text" name="keyWord" id="keyWord"/>

<input type="button" id="search" value="查询"  />

<div id="map-canvas" style="width: 800px; height: 580px"></div>

<iframe name="mapIframe" id="mapIframe" style="display:none" src="local.html"></iframe>
</body>
</html>
