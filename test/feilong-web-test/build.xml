<project name="feilong-web-test" basedir="." default="deploy-forHudson-nocompressorJSCSS" xmlns:artifact="antlib:org.apache.maven.artifact.ant">
	<property file="${basedir}/build.properties" />

	<property file="E:/DataCommon/java/Taglib/Apache Ant/config/build-feilong.properties" />
	<import file="${path.config}/build-config-common-nested.xml" />
	<!-- <import file="${path.config}/build-feilong-nested.xml" /> -->

	<property name="deploy.lib" value="${deploy.home}/WEB-INF/lib" />
	<mkdir dir="${deploy.home}/WEB-INF/classes" />
	<mkdir dir="${deploy.lib}" />

	<!--定义Maven2变量 -->
	<artifact:pom id="feilongMaven" file="pom.xml" />
	<artifact:dependencies filesetId="feilong.maven.dependencies.fileset" pathid="feilong.maven.dependencies.runtime" useScope="runtime">
		<pom refid="feilongMaven" />
	</artifact:dependencies>

	<artifact:dependencies pathid="feilong.maven.dependencies.system" scopes="system">
		<pom refid="feilongMaven" />
	</artifact:dependencies>

	<artifact:dependencies pathid="feilong.maven.dependencies.all">
		<pom refid="feilongMaven" />
	</artifact:dependencies>

	<!-- install -->
	<target name="maven-install" description="install">
		<echo>[install]:ant use maven to install project</echo>
		<artifact:mvn pom="pom.xml">
			<arg value="clean" />
			<arg value="install" />
		</artifact:mvn>
	</target>

	<!-- copyLib -->
	<target name="copyLib" description="copy lib">
		<echo>[copyLib]:will be copied maven dependencies jar(runtime and system scope)</echo>


		<delete dir="${deploy.home}/WEB-INF/lib" />
		<mkdir dir="${deploy.home}/WEB-INF/lib" />
		<!-- <echo>use:../${repo.name}/pom.xml</echo> -->
		<!-- <artifact:mvn pom="../${repo.name}/pom.xml"> <arg value="clean" /> <arg value="install" /> </artifact:mvn> -->

		<copy todir="${deploy.lib}">
			<fileset refid="feilong.maven.dependencies.fileset" />
			<mapper type="flatten" />
		</copy>

		<for param="mavenSystemJar">
			<path refid="feilong.maven.dependencies.system" />
			<sequential>
				<echo>@{mavenSystemJar}</echo>
				<copy todir="${deploy.lib}" file="@{mavenSystemJar}" />
			</sequential>
		</for>
	</target>

	<!-- copyClass -->
	<target name="copyClass">
		<delete dir="${deploy.home}/WEB-INF/classes" />
		<echo>[copyClass]:Compiled classes will be copied and no pre-compile works done.
			Please confirm the source codes are
			compiled successfully.</echo>
		<copy todir="${deploy.home}/WEB-INF/classes">
			<fileset dir="${feilongMaven.build.outputDirectory}" />
		</copy>
	</target>

	<!-- copyJsp -->
	<target name="copyJsp">
		<copy todir="${deploy.home}">
			<fileset dir="${basedir}/src/main/webapp" />
		</copy>
	</target>

	<!-- 用于集成测试 -->
	<target name="deploy-forHudson-nocompressorJSCSS" description="deleteclasses,deletelib,copyLib,maven-install,copyClass,copyJsp">
		<delete dir="${deploy.home}/WEB-INF/classes" />
		<delete dir="${deploy.home}/WEB-INF/lib" />
		<antcall target="copyLib" />
		<antcall target="maven-install" />
		<antcall target="copyClass" />
		<antcall target="copyJsp" />
	</target>
</project>